version: 0.2

phases:
  install:
    runtime-versions:
      ruby: 2.6

    commands:
      - apt-get update -y
      - apt-get install -y webp exiftool pngcrush gzip git cmake
      - git clone https://github.com/google/brotli.git /tmp/brotli
      - cd /tmp/brotli && git checkout v1.0.7
      - mkdir /tmp/brotli/out
      - cd /tmp/brotli/out && ../configure-cmake --disable-debug
      - make
      - make install
      - cd $CODEBUILD_SRC_DIR

  build:
    commands:
      - gem install bundler
      - bundle install
      - bundle exec jekyll build
      - bundle exec rake

artifacts:
  files:
    - _site/**/*
    - appspec.yml
    - _server/*
    - _deploy/*
  name: site
